<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SUV Speedometer HUD</title>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="hud">

  <!-- RPM -->
  <div id="rpmCircle">
    <canvas id="rpmCanvas" width="140" height="140"></canvas>
  </div>

  <!-- SPEED BOX -->
  <div id="speedBox">

    <div id="gear">N</div>
    <div id="speed">0</div>
    <div id="unit">MPH</div>

    <!-- STATUS ICONS -->
    <div id="statusIcons">
      <span id="icon-engine" class="icon">ðŸ”§</span>
      <span id="icon-light" class="icon">ðŸ’¡</span>
      <span id="icon-seatbelt" class="icon">ðŸª¢</span>
      <span id="icon-left" class="icon">â—€</span>
      <span id="icon-right" class="icon">â–¶</span>
    </div>

    <!-- BARS -->
    <div id="bars">
      <div class="barRow">
        <span class="barIcon">â›½</span>
        <div class="bar">
          <div id="fuelBar" class="fillFuel"></div>
        </div>
      </div>

      <div class="barRow">
        <span class="barIcon">ðŸ”§</span>
        <div class="bar">
          <div id="engineBar" class="fillEngine"></div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- AUDIO -->
<audio id="welcomeAudio" src="welcome.mp3" preload="auto"></audio>

<script src="script.js"></script>

<script>
/* ================= RPM (AMAN, TIDAK DIUBAH) ================= */
const ctx = rpmCanvas.getContext("2d");
let rpmSmooth = 0;

function drawRPM(r) {
  rpmSmooth += (r - rpmSmooth) * 0.12;
  ctx.clearRect(0, 0, 140, 140);

  const cx = 70, cy = 70, rad = 58;

  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(cx, cy, rad, 0, Math.PI * 2);
  ctx.fill();

  ctx.strokeStyle = "#444";
  ctx.lineWidth = 3;
  ctx.stroke();

  for (let i = 0; i <= 8; i++) {
    const ang = (-130 + i * 32.5) * Math.PI / 180;
    ctx.strokeStyle = i >= 7 ? "#ff4444" : "#cccccc";
    ctx.lineWidth = 2;

    ctx.beginPath();
    ctx.moveTo(cx + Math.cos(ang) * (rad - 6), cy + Math.sin(ang) * (rad - 6));
    ctx.lineTo(cx + Math.cos(ang) * rad, cy + Math.sin(ang) * rad);
    ctx.stroke();

    ctx.fillStyle = "#fff";
    ctx.font = "10px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(i, cx + Math.cos(ang) * (rad - 16), cy + Math.sin(ang) * (rad - 16));
  }

  const needle = (-130 + rpmSmooth * 260) * Math.PI / 180;
  ctx.strokeStyle = "#ff3333";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + Math.cos(needle) * (rad - 12), cy + Math.sin(needle) * (rad - 12));
  ctx.stroke();
}

window.setRPM = v => drawRPM(v);

/* ================= ICON + AUDIO HOOK (AMAN) ================= */
const welcomeAudio = document.getElementById("welcomeAudio");

let engineWasOn = false;

const engineIcon = document.getElementById("icon-engine");
const lightIcon = document.getElementById("icon-light");
const seatbeltIcon = document.getElementById("icon-seatbelt");
const leftIcon = document.getElementById("icon-left");
const rightIcon = document.getElementById("icon-right");

/* WRAP FUNCTIONS â€“ TIDAK MERUSAK LOGIC */
const _setEngine = window.setEngine;
window.setEngine = function(state) {
  _setEngine(state);
  engineIcon.classList.toggle("on", state);

  if (state && !engineWasOn) {
    setTimeout(() => {
      welcomeAudio.currentTime = 0;
      welcomeAudio.play();
    }, 1000);
  }

  engineWasOn = state;
};

const _setHeadlights = window.setHeadlights;
window.setHeadlights = function(state) {
  _setHeadlights(state);
  lightIcon.classList.toggle("on", state > 0);
};

const _setSeatbelts = window.setSeatbelts;
window.setSeatbelts = function(state) {
  _setSeatbelts(state);
  seatbeltIcon.classList.toggle("on", state);
};

const _setLeftIndicator = window.setLeftIndicator;
window.setLeftIndicator = function(state) {
  _setLeftIndicator(state);
  leftIcon.classList.toggle("on", state);
};

const _setRightIndicator = window.setRightIndicator;
window.setRightIndicator = function(state) {
  _setRightIndicator(state);
  rightIcon.classList.toggle("on", state);
};

setSpeedMode(1); // MPH
</script>

</body>
</html>
