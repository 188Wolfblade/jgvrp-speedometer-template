<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SUV HUD</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="hud">

  <!-- RPM -->
  <div id="rpmBox">
    <canvas id="rpmCanvas" width="120" height="120"></canvas>
  </div>

  <!-- SPEED / GEAR -->
  <div id="speedBox">
    <div id="gear">N</div>
    <div id="speed">0</div>

    <div class="barRow">
      â›½
      <div class="bar"><div id="fuelBar"></div></div>
    </div>

    <div class="barRow">
      ðŸ”§
      <div class="bar"><div id="engineBar"></div></div>
    </div>
  </div>

</div>

<!-- REQUIRED BINDS -->
<div id="rpm" hidden></div>
<div id="engine" hidden></div>

<script src="script.js"></script>

<script>
/* ===== BMW LOGIC COPY (DO NOT TOUCH) ===== */
const ctx = rpmCanvas.getContext("2d");
let rpmSmooth = 0;
let lastSpeed = 0;

function drawRPM(rpm) {
  if (rpm < 0.02) rpm = 0; // ðŸ”‘ FIX mesin mati
  rpmSmooth += (rpm - rpmSmooth) * 0.15;

  ctx.clearRect(0,0,120,120);
  const cx=60, cy=60, r=46;

  // background arc
  ctx.strokeStyle="#330000";
  ctx.lineWidth=6;
  ctx.beginPath();
  ctx.arc(cx,cy,r,0,Math.PI*2);
  ctx.stroke();

  // ticks
  for(let i=0;i<=7;i++){
    const a=(-130+i*37)*Math.PI/180;
    ctx.strokeStyle=i>=6?"#ff3333":"#ffaaaa";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(cx+Math.cos(a)*(r-8),cy+Math.sin(a)*(r-8));
    ctx.lineTo(cx+Math.cos(a)*r,cy+Math.sin(a)*r);
    ctx.stroke();
  }

  // needle
  const ang=(-130+rpmSmooth*260)*Math.PI/180;
  ctx.strokeStyle="#ff2222";
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.lineTo(cx+Math.cos(ang)*(r-12),cy+Math.sin(ang)*(r-12));
  ctx.stroke();
}

/* ===== HOOKS (BMW STYLE) ===== */
window.setRPM = v => drawRPM(v);

window.setFuel = f =>
  fuelBar.style.width = (f*100)+"%";

window.setHealth = h =>
  engineBar.style.width = (h*100)+"%";

/* GEAR FIX */
const speedEl = document.getElementById("speed");
const gearEl  = document.getElementById("gear");

const speedObserver = new MutationObserver(()=>{
  const s = parseInt(speedEl.innerText) || 0;
  lastSpeed = s;
});

speedObserver.observe(speedEl,{childList:true});

window.setGear = g => {
  if(lastSpeed < 0) gearEl.innerText="R";
  else if(lastSpeed === 0) gearEl.innerText="N";
  else gearEl.innerText = g;
};
</script>

</body>
</html>
