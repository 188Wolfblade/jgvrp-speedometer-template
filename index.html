<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BMW HUD Final FIX</title>

<style>
body {
  margin: 0;
  background: transparent;
  font-family: Arial, sans-serif;
}

#hud {
  position: fixed;
  bottom: 28px;
  right: 28px;
  display: flex;
  gap: 0;
  align-items: flex-end;
}

.circle {
  border-radius: 50%;
  position: relative;
  color: white;
}

/* RPM */
#rpmCircle {
  width: 150px;
  height: 150px;
  background: radial-gradient(circle, #0a1a2a 40%, #000 75%);
}

#rpmCanvas {
  position: absolute;
  top: 5px;
  left: 5px;
}

/* SPEED */
#speedWrap {
  display: flex;
  flex-direction: column;
  align-items: center;
}

#speedCircle {
  width: 220px;
  height: 220px;
  background: radial-gradient(circle, #0a2238 35%, #000 80%);
}

/* TEXT */
#gear {
  position: absolute;
  top: 24px;
  width: 100%;
  text-align: center;
  font-size: 26px;
}

#speed {
  position: absolute;
  top: 60px;
  width: 100%;
  text-align: center;
  font-size: 46px;
  font-weight: bold;
}

#unit {
  position: absolute;
  top: 112px;
  width: 100%;
  text-align: center;
  font-size: 13px;
  opacity: 0.6;
}

/* BARS */
#bars {
  position: absolute;
  bottom: 44px;
  width: 80%;
  left: 10%;
}

.barWrap {
  display: flex;
  align-items: center;
  margin-bottom: 6px;
}

.bar {
  flex: 1;
  height: 6px;
  background: #0a2438;
  border-radius: 6px;
}

.fillFuel { background: #4db8ff; height:100%; }
.fillEngine { background: #6fd0ff; height:100%; }

/* STATUS ICON */
#status {
  margin-top: 6px;
  display: flex;
  gap: 14px;
  font-size: 16px;
}

.off { color: #555; }
.on  { color: #7fd4ff; text-shadow:0 0 8px #7fd4ff; }
.blink { opacity: 0.2; }
</style>
</head>

<body>

<div id="hud">

  <div id="rpmCircle" class="circle">
    <canvas id="rpmCanvas" width="140" height="140"></canvas>
  </div>

  <div id="speedWrap">

    <div id="speedCircle" class="circle">
      <div id="gear">N</div>
      <div id="speed">0</div>
      <div id="unit">MPH</div>

      <div id="bars">
        <div class="barWrap"><div class="bar"><div id="fuelBar" class="fillFuel"></div></div></div>
        <div class="barWrap"><div class="bar"><div id="engineBar" class="fillEngine"></div></div></div>
      </div>
    </div>

    <div id="status">
      <span id="engineIcon" class="off">üîß</span>
      <span id="lightIcon"  class="off">üí°</span>
      <span id="leftIcon"   class="off">‚óÄÔ∏è</span>
      <span id="rightIcon"  class="off">‚ñ∂Ô∏è</span>
    </div>

  </div>

</div>

<script src="script.js"></script>

<script>
/* ================= STATE ================= */
let engineOn = false;
let leftOn = false;
let rightOn = false;
let blinkTimer = null;

/* ================= RPM ================= */
const ctx = rpmCanvas.getContext("2d");
let rpmSmooth = 0;

function drawRPM(r) {
  rpmSmooth += (r - rpmSmooth) * 0.15;
  ctx.clearRect(0,0,140,140);
}

/* ================= BLINK ================= */
function startBlink() {
  if (blinkTimer) return;
  blinkTimer = setInterval(() => {
    if (leftOn) leftIcon.classList.toggle("blink");
    if (rightOn) rightIcon.classList.toggle("blink");
  }, 450);
}

function stopBlink() {
  clearInterval(blinkTimer);
  blinkTimer = null;
  leftIcon.classList.remove("blink");
  rightIcon.classList.remove("blink");
}

/* ================= TEMPLATE HOOK ================= */
window.setRPM = v => drawRPM(v);

window.setSpeed = s => speed.innerText = Math.round(s * 2.23694);

window.setGear = g => gear.innerText = (g === 0 ? "R" : g);

window.setFuel = f => fuelBar.style.width = (f*100)+"%";

window.setHealth = h => engineBar.style.width = (h*100)+"%";

/* ENGINE */
window.setEngine = state => {
  engineOn = state;
  engineIcon.className = state ? "on" : "off";

  if (!state) {
    leftOn = rightOn = false;
    stopBlink();
    leftIcon.className = rightIcon.className = "off";
    lightIcon.className = "off";
  }
};

/* LIGHT */
window.setHeadlights = state =>
  lightIcon.className = state > 0 && engineOn ? "on" : "off";

/* TURN SIGNAL */
window.setLeftIndicator = state => {
  leftOn = state && engineOn;
  leftIcon.className = leftOn ? "on" : "off";
  state ? startBlink() : stopBlink();
};

window.setRightIndicator = state => {
  rightOn = state && engineOn;
  rightIcon.className = rightOn ? "on" : "off";
  state ? startBlink() : stopBlink();
};

setSpeedMode(1);
</script>

</body>
</html>
